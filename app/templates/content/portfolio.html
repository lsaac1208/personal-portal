{% extends "base.html" %}

{% block title %}项目作品集 - 个人门户网站{% endblock %}
{% block meta_description %}浏览我的项目作品集，包括Web应用、技术工具和开源项目。展示技术能力和创新解决方案。{% endblock %}
{% block meta_keywords %}项目作品集,Web开发,技术项目,开源项目,全栈开发,编程作品{% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb" class="bg-light py-3">
    <div class="container">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
                <a href="{{ url_for('main.index') }}" class="text-decoration-none">
                    <i class="fas fa-home"></i> 首页
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">项目作品集</li>
        </ol>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header Section -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="text-center mb-4">
                <h1 class="display-4 mb-3">
                    <i class="fas fa-briefcase text-primary"></i> 项目作品集
                </h1>
                <p class="lead text-muted">
                    探索我的技术项目和创新解决方案，展示全栈开发能力和技术创新思维
                </p>
            </div>
            
            <!-- Enhanced Filter and Search Section -->
            <div class="row mb-4">
                <!-- Search Bar -->
                <div class="col-12 mb-3">
                    <div class="search-container">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control" id="projectSearch" 
                                   placeholder="搜索项目名称、描述、技术栈..." 
                                   value="{{ request.args.get('search', '') }}">
                            <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Filter Options -->
                <div class="col-lg-9 mb-3">
                    <!-- Project Type Filters -->
                    <div class="filter-section mb-2">
                        <small class="text-muted fw-bold">项目类型：</small>
                        <div class="btn-group btn-group-sm filter-buttons" role="group" aria-label="项目类型筛选">
                            <button type="button" class="btn btn-outline-primary filter-btn active" data-filter="all">
                                <i class="fas fa-list me-1"></i>全部
                            </button>
                            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="Web应用">
                                🌐 Web应用
                            </button>
                            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="移动应用">
                                📱 移动应用
                            </button>
                            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="工具库">
                                🔧 工具库
                            </button>
                            <button type="button" class="btn btn-outline-primary filter-btn" data-filter="开源项目">
                                🌟 开源项目
                            </button>
                        </div>
                    </div>
                    
                    <!-- Status Filters -->
                    <div class="filter-section mb-2">
                        <small class="text-muted fw-bold">项目状态：</small>
                        <div class="btn-group btn-group-sm filter-buttons" role="group" aria-label="项目状态筛选">
                            <button type="button" class="btn btn-outline-success status-filter active" data-status="all">
                                全部状态
                            </button>
                            <button type="button" class="btn btn-outline-success status-filter" data-status="已完成">
                                ✅ 已完成
                            </button>
                            <button type="button" class="btn btn-outline-warning status-filter" data-status="开发中">
                                🔄 开发中
                            </button>
                            <button type="button" class="btn btn-outline-info status-filter" data-status="规划中">
                                📋 规划中
                            </button>
                        </div>
                    </div>
                    
                    <!-- Technology Filters -->
                    <div class="filter-section">
                        <small class="text-muted fw-bold">技术栈：</small>
                        <div id="techFilters" class="tech-filters">
                            <!-- 动态生成技术标签 -->
                        </div>
                    </div>
                </div>
                
                <!-- Sort and View Options -->
                <div class="col-lg-3 text-lg-end">
                    <div class="d-flex flex-column gap-2">
                        <!-- Sort Dropdown -->
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle btn-sm" type="button" 
                                    id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-sort me-1"></i>排序方式
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                                <li><a class="dropdown-item sort-option active" href="#" data-sort="latest">
                                    <i class="fas fa-clock me-2"></i>最新项目</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-sort="featured">
                                    <i class="fas fa-star me-2"></i>精选推荐</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-sort="status">
                                    <i class="fas fa-tasks me-2"></i>项目状态</a></li>
                                <li><a class="dropdown-item sort-option" href="#" data-sort="alphabetical">
                                    <i class="fas fa-sort-alpha-down me-2"></i>按名称</a></li>
                            </ul>
                        </div>
                        
                        <!-- Results Count -->
                        <small class="text-muted">
                            <span id="resultsCount">{{ projects.items|length if projects else 0 }}</span> 个项目
                        </small>
                        
                        <!-- Clear All Filters -->
                        <button class="btn btn-outline-danger btn-sm" id="clearAllFilters" style="display: none;">
                            <i class="fas fa-eraser me-1"></i>清除筛选
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Projects Grid -->
    <div class="row">
        <div class="col-lg-8">
            {% if projects %}
            <div class="row g-4 mb-5">
                {% for project in projects.items %}
                <div class="col-lg-6">
                    <div class="card h-100 shadow-sm hover-lift">
                        {% if project.featured_image %}
                        <div class="position-relative">
                            <img src="{{ url_for('static', filename='uploads/' + project.featured_image) }}" 
                                 class="card-img-top" alt="{{ project.title }}" loading="lazy"
                                 style="height: 200px; object-fit: cover;">
                            <span class="badge bg-{{ 'success' if project.status == '已完成' else 'warning' if project.status == '开发中' else 'secondary' }} position-absolute top-0 end-0 m-2">
                                {{ project.status }}
                            </span>
                        </div>
                        {% else %}
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <span>
                                <i class="fas fa-{{ 'globe' if project.project_type == 'Web应用' else 'mobile-alt' if project.project_type == '移动应用' else 'tools' if project.project_type == '工具库' else 'star' }} me-2"></i>
                                {{ project.project_type }}
                            </span>
                            <span class="badge bg-{{ 'success' if project.status == '已完成' else 'warning' if project.status == '开发中' else 'secondary' }}">
                                {{ project.status }}
                            </span>
                        </div>
                        {% endif %}
                        
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">
                                <a href="{{ url_for('content.project_detail', id=project.id) }}" 
                                   class="text-decoration-none text-dark">
                                    {{ project.title }}
                                </a>
                            </h5>
                            
                            {% if project.subtitle %}
                            <h6 class="card-subtitle text-muted mb-3">{{ project.subtitle }}</h6>
                            {% endif %}
                            
                            <p class="card-text flex-grow-1">
                                {{ project.description | striptags | truncate(120) }}
                            </p>
                            
                            <!-- Tech Stack -->
                            {% if project.tech_stack %}
                            <div class="mb-3">
                                {% for tech in project.tech_stack[:4] %}
                                <span class="badge bg-light text-primary me-1 mb-1">
                                    {{ tech }}
                                </span>
                                {% endfor %}
                                {% if project.tech_stack | length > 4 %}
                                <span class="badge bg-light text-muted">+{{ project.tech_stack | length - 4 }}</span>
                                {% endif %}
                            </div>
                            {% endif %}
                            
                            <!-- 🆕 GitHub Stats Integration -->
                            {% if github_stats.get(project.github_url) and github_stats[project.github_url].available %}
                            {% set gh_stats = github_stats[project.github_url] %}
                            <div class="github-stats mb-3 p-2 bg-light rounded">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex gap-3">
                                        {% if gh_stats.stars > 0 %}
                                        <small class="text-muted">
                                            <i class="fas fa-star text-warning me-1"></i>
                                            <span class="github-stat-value">{{ gh_stats.stars }}</span>
                                        </small>
                                        {% endif %}
                                        {% if gh_stats.forks > 0 %}
                                        <small class="text-muted">
                                            <i class="fas fa-code-branch text-info me-1"></i>
                                            <span class="github-stat-value">{{ gh_stats.forks }}</span>
                                        </small>
                                        {% endif %}
                                        {% if gh_stats.language %}
                                        <small class="text-muted">
                                            <i class="fas fa-code text-primary me-1"></i>
                                            <span class="github-language">{{ gh_stats.language }}</span>
                                        </small>
                                        {% endif %}
                                    </div>
                                    {% if gh_stats.updated_at %}
                                    <small class="text-muted">
                                        <i class="fas fa-sync-alt me-1"></i>
                                        <span class="github-updated">{{ gh_stats.updated_at }}</span>
                                    </small>
                                    {% endif %}
                                </div>
                                
                                <!-- Language Distribution (if available) -->
                                {% if gh_stats.languages %}
                                <div class="mt-2">
                                    <div class="language-bar d-flex rounded overflow-hidden" style="height: 4px;">
                                        {% for lang in gh_stats.languages[:3] %}
                                        <div class="language-segment" 
                                             style="width: {{ lang.percentage }}%; background-color: {{ get_language_color(lang.name) }};"
                                             title="{{ lang.name }}: {{ lang.percentage }}%"></div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- Project Meta -->
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    {% if project.completion_date %}
                                    {{ moment(project.completion_date).format('YYYY年MM月') }}
                                    {% else %}
                                    {{ moment(project.start_date).format('YYYY年MM月') }}
                                    {% endif %}
                                </small>
                                {% if project.is_featured %}
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-star"></i> 精选
                                </span>
                                {% endif %}
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="d-flex gap-2">
                                <a href="{{ url_for('content.project_detail', id=project.id) }}" 
                                   class="btn btn-primary btn-sm flex-grow-1">
                                    查看详情
                                </a>
                                {% if project.demo_url %}
                                <a href="{{ project.demo_url }}" class="btn btn-outline-success btn-sm" 
                                   target="_blank" title="在线演示">
                                    <i class="fas fa-external-link-alt"></i>
                                </a>
                                {% endif %}
                                {% if project.github_url %}
                                <a href="{{ project.github_url }}" class="btn btn-outline-dark btn-sm" 
                                   target="_blank" title="源代码">
                                    <i class="fab fa-github"></i>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if projects.pages > 1 %}
            <nav aria-label="项目分页">
                <ul class="pagination justify-content-center">
                    {% if projects.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('content.portfolio', 
                                                            project_type=project_type, page=projects.prev_num) }}" 
                           aria-label="上一页">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    </li>
                    {% endif %}
                    
                    {% for page_num in projects.iter_pages() %}
                        {% if page_num %}
                            {% if page_num != projects.page %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('content.portfolio', 
                                                                    project_type=project_type, page=page_num) }}">
                                    {{ page_num }}
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item active" aria-current="page">
                                <span class="page-link">{{ page_num }}</span>
                            </li>
                            {% endif %}
                        {% else %}
                        <li class="page-item disabled">
                            <span class="page-link">...</span>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if projects.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('content.portfolio', 
                                                            project_type=project_type, page=projects.next_num) }}" 
                           aria-label="下一页">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            {% endif %}
            
            {% else %}
            <!-- Empty State -->
            <div class="text-center py-5">
                <div class="mb-4">
                    <i class="fas fa-folder-open fa-4x text-muted"></i>
                </div>
                <h3 class="text-muted mb-3">
                    {% if project_type %}
                    {{ project_type }}项目正在开发中
                    {% else %}
                    项目作品集即将呈现
                    {% endif %}
                </h3>
                <p class="text-muted mb-4">
                    精彩项目正在创作中，敬请期待最新作品发布。
                </p>
                <div>
                    {% if project_type %}
                    <a href="{{ url_for('content.portfolio') }}" class="btn btn-primary me-2">
                        <i class="fas fa-list me-1"></i>查看全部项目
                    </a>
                    {% endif %}
                    <a href="{{ url_for('main.index') }}" class="btn btn-outline-primary">
                        <i class="fas fa-home me-1"></i>返回首页
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <div class="sticky-top" style="top: 100px;">
                <!-- Project Stats -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>项目统计
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="h3 text-success mb-1">{{ stats.completed_projects or 0 }}</div>
                                <small class="text-muted">已完成</small>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="h3 text-warning mb-1">{{ stats.in_progress_projects or 0 }}</div>
                                <small class="text-muted">开发中</small>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="h3 text-primary mb-1">{{ stats.total_projects or 0 }}</div>
                                <small class="text-muted">总项目</small>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="h3 text-info mb-1">{{ stats.featured_projects or 0 }}</div>
                                <small class="text-muted">精选项目</small>
                            </div>
                            
                            <!-- 🆕 GitHub Statistics -->
                            {% if stats.github_enabled %}
                            <div class="col-12 mt-3 pt-3 border-top">
                                <h6 class="text-muted mb-3">
                                    <i class="fab fa-github me-2"></i>GitHub 统计
                                </h6>
                                <div class="row">
                                    <div class="col-6 mb-2">
                                        <div class="h4 text-warning mb-1">
                                            <i class="fas fa-star me-1"></i>{{ stats.total_stars or 0 }}
                                        </div>
                                        <small class="text-muted">总收藏</small>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <div class="h4 text-info mb-1">
                                            <i class="fas fa-code-branch me-1"></i>{{ stats.total_forks or 0 }}
                                        </div>
                                        <small class="text-muted">总派生</small>
                                    </div>
                                </div>
                                <div class="text-center mt-2">
                                    <small class="text-muted">
                                        <i class="fab fa-github me-1"></i>{{ stats.github_projects or 0 }}/{{ stats.total_projects or 0 }} 项目有GitHub仓库
                                    </small>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Technology Stack -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-layer-group me-2"></i>技术栈
                        </h6>
                    </div>
                    <div class="card-body">
                        {% if tech_stats %}
                        <div class="tech-cloud">
                            {% for tech, count in tech_stats %}
                            <span class="badge bg-light text-primary me-1 mb-2"
                                  style="font-size: {{ 0.75 + (count / 10) }}rem;">
                                {{ tech }} <span class="text-muted">({{ count }})</span>
                            </span>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-muted mb-0">技术栈统计即将更新</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Featured Projects Enhanced -->
                {% if featured_projects %}
                <div class="card mb-4 featured-projects-card">
                    <div class="card-header bg-gradient-primary text-white">
                        <h6 class="mb-0">
                            <i class="fas fa-star me-2"></i>精选项目推荐
                        </h6>
                        <small class="opacity-75">基于您的浏览历史智能推荐</small>
                    </div>
                    <div class="card-body p-0">
                        {% for project in featured_projects %}
                        <div class="featured-project-item d-flex align-items-center p-3 {% if not loop.last %}border-bottom{% endif %} hover-bg-light">
                            <!-- Project Thumbnail -->
                            <div class="flex-shrink-0 me-3">
                                {% if project.featured_image %}
                                <img src="{{ url_for('static', filename='uploads/' + project.featured_image) }}" 
                                     class="featured-project-thumb rounded" alt="{{ project.title }}"
                                     style="width: 50px; height: 50px; object-fit: cover;">
                                {% else %}
                                <div class="featured-project-icon rounded d-flex align-items-center justify-content-center"
                                     style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <i class="fas fa-{{ 'globe' if project.project_type == 'Web应用' else 'mobile-alt' if project.project_type == '移动应用' else 'tools' if project.project_type == '工具库' else 'star' }} text-white"></i>
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Project Info -->
                            <div class="flex-grow-1 min-width-0">
                                <h6 class="mb-1 text-truncate">
                                    <a href="{{ url_for('content.project_detail', id=project.id) }}" 
                                       class="text-decoration-none text-dark stretched-link">
                                        {{ project.title }}
                                    </a>
                                </h6>
                                <div class="d-flex align-items-center gap-2 mb-1">
                                    <span class="badge bg-primary bg-opacity-10 text-primary">
                                        {{ project.project_type }}
                                    </span>
                                    <span class="badge bg-{{ 'success' if project.status == '已完成' else 'warning' if project.status == '开发中' else 'secondary' }} bg-opacity-10">
                                        {{ project.status }}
                                    </span>
                                </div>
                                {% if project.tech_stack %}
                                <small class="text-muted d-block text-truncate">
                                    {{ project.tech_stack[:3]|join(', ') }}
                                    {% if project.tech_stack|length > 3 %}...{% endif %}
                                </small>
                                {% endif %}
                            </div>
                            
                            <!-- Quick Actions -->
                            <div class="flex-shrink-0 ms-2">
                                <div class="btn-group-vertical btn-group-sm">
                                    {% if project.demo_url %}
                                    <a href="{{ project.demo_url }}" class="btn btn-outline-success btn-xs" 
                                       target="_blank" title="在线演示" onclick="event.stopPropagation();">
                                        <i class="fas fa-external-link-alt"></i>
                                    </a>
                                    {% endif %}
                                    {% if project.github_url %}
                                    <a href="{{ project.github_url }}" class="btn btn-outline-dark btn-xs" 
                                       target="_blank" title="源代码" onclick="event.stopPropagation();">
                                        <i class="fab fa-github"></i>
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- View All Featured Projects -->
                        <div class="p-3 text-center bg-light">
                            <a href="{{ url_for('content.portfolio', project_type='精选') }}" 
                               class="btn btn-sm btn-primary">
                                <i class="fas fa-arrow-right me-1"></i>查看全部精选项目
                            </a>
                        </div>
                    </div>
                </div>
                {% else %}
                <!-- Recommendation Placeholder -->
                <div class="card mb-4 recommendation-placeholder">
                    <div class="card-body text-center py-4">
                        <i class="fas fa-lightbulb fa-2x text-muted mb-3"></i>
                        <h6 class="text-muted">项目推荐</h6>
                        <p class="small text-muted mb-3">
                            当您有更多项目时，我们会在这里为您推荐精选内容
                        </p>
                        <a href="{{ url_for('content.portfolio') }}" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-plus me-1"></i>浏览所有项目
                        </a>
                    </div>
                </div>
                {% endif %}
                
                <!-- Contact CTA -->
                <div class="card">
                    <div class="card-body text-center">
                        <h6 class="card-title">
                            <i class="fas fa-handshake me-2"></i>项目合作
                        </h6>
                        <p class="card-text small text-muted">
                            有项目想法？需要技术咨询？让我们一起实现您的创意！
                        </p>
                        <a href="{{ url_for('main.inquiry_form') }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-envelope me-1"></i>联系合作
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Bootstrap Pagination Styles - Missing from custom Bootstrap CSS */
.pagination {
    display: flex;
    padding-left: 0;
    list-style: none !important;
    border-radius: 0.375rem;
    margin-bottom: 0;
}

.page-item:not(:first-child) .page-link {
    margin-left: -1px;
}

.page-link {
    position: relative;
    display: block;
    color: #0d6efd;
    text-decoration: none;
    background-color: #fff;
    border: 1px solid #dee2e6;
    transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    padding: 0.375rem 0.75rem;
    margin-left: -1px;
    line-height: 1.25;
}

.page-link:hover {
    z-index: 2;
    color: #0a58ca;
    background-color: #e9ecef;
    border-color: #dee2e6;
}

.page-item:first-child .page-link {
    border-top-left-radius: 0.375rem;
    border-bottom-left-radius: 0.375rem;
}

.page-item:last-child .page-link {
    border-top-right-radius: 0.375rem;
    border-bottom-right-radius: 0.375rem;
}

.page-item.active .page-link {
    z-index: 3;
    color: #fff;
    background-color: #0d6efd;
    border-color: #0d6efd;
}

.page-item.disabled .page-link {
    color: #6c757d;
    pointer-events: none;
    background-color: #fff;
    border-color: #dee2e6;
}

.tech-cloud .badge {
    transition: all 0.3s ease;
}

.tech-cloud .badge:hover {
    transform: scale(1.1);
    background-color: var(--bs-primary) !important;
    color: white !important;
}

/* 🆕 GitHub Integration Styles */
.github-stats {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid rgba(0,0,0,0.05);
    transition: all 0.3s ease;
}

.github-stats:hover {
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.github-stat-value {
    font-weight: 600;
    color: #495057;
}

.github-language {
    font-weight: 500;
    color: #495057;
}

.github-updated {
    font-size: 0.75rem;
}

.language-bar {
    border-radius: 2px;
    overflow: hidden;
    background-color: #e9ecef;
}

.language-segment {
    transition: opacity 0.3s ease;
}

.language-segment:hover {
    opacity: 0.8;
}

/* GitHub Language Colors */
.language-python { background-color: #3776ab; }
.language-javascript { background-color: #f1e05a; }
.language-typescript { background-color: #2b7489; }
.language-java { background-color: #b07219; }
.language-go { background-color: #00add8; }
.language-rust { background-color: #dea584; }
.language-cpp { background-color: #f34b7d; }
.language-css { background-color: #563d7c; }
.language-html { background-color: #e34c26; }
.language-shell { background-color: #89e051; }
.language-vue { background-color: #2c3e50; }
.language-react { background-color: #61dafb; }

/* GitHub Statistics in Sidebar */
.github-stats-sidebar .h4 {
    font-size: 1.5rem;
    font-weight: 700;
}

.github-stats-sidebar .h4 i {
    font-size: 1.2rem;
}

/* Enhanced Search and Filter Styles */
.search-container {
    max-width: 600px;
    margin: 0 auto;
}

.filter-section {
    border-bottom: 1px solid var(--bs-border-color);
    padding-bottom: 0.5rem;
}

.filter-section:last-child {
    border-bottom: none;
}

.filter-buttons .btn {
    margin-right: 0.25rem;
    margin-bottom: 0.25rem;
    transition: all 0.3s ease;
}

.filter-buttons .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.tech-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    max-height: 100px;
    overflow-y: auto;
}

.tech-filter-tag {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    background-color: var(--bs-light);
    border: 1px solid var(--bs-border-color);
    border-radius: 0.375rem;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.tech-filter-tag:hover {
    background-color: var(--bs-primary);
    color: white;
    transform: scale(1.05);
}

.tech-filter-tag.active {
    background-color: var(--bs-primary);
    color: white;
    border-color: var(--bs-primary);
}

.project-card {
    transition: all 0.3s ease;
}

.project-card.filtered-out {
    display: none;
}

/* Enhanced hover effects for main project cards */
.hover-lift {
    transition: all 0.3s ease;
}

.hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
}

.card {
    border: none;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 2px 15px rgba(0,0,0,0.08);
}

.card-header {
    border-bottom: none;
    font-weight: 600;
}

.badge {
    font-weight: 500;
    padding: 0.35em 0.8em;
    border-radius: 0.5rem;
}

/* Project card enhancements */
.card-body .btn {
    border-radius: 0.5rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.card-body .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.no-results {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--bs-secondary);
}

.no-results i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

/* Enhanced Featured Projects Styles */
.featured-projects-card {
    border: none;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border-radius: 1rem;
    overflow: hidden;
}

.featured-projects-card .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    padding: 1.25rem 1.5rem 1rem;
}

.featured-project-item {
    transition: all 0.3s ease;
    position: relative;
    padding: 1rem 1.5rem !important;
    border-bottom: 1px solid rgba(0,0,0,0.08);
}

.featured-project-item:hover {
    background-color: rgba(0,0,0,0.02);
    transform: translateX(2px);
}

.featured-project-item:last-child {
    border-bottom: none;
}

.featured-project-thumb {
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
}

.featured-project-thumb:hover {
    transform: scale(1.05);
}

.featured-project-icon {
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
}

.featured-project-icon:hover {
    transform: scale(1.05);
}

.featured-project-item .badge {
    font-size: 0.7rem;
    padding: 0.25em 0.6em;
    font-weight: 500;
}

.featured-project-item h6 {
    font-weight: 600;
    color: #333;
    margin-bottom: 0.5rem;
}

.featured-project-item small {
    font-size: 0.75rem;
    color: #6c757d;
}

.btn-xs {
    padding: 0.15rem 0.4rem;
    font-size: 0.7rem;
    line-height: 1.2;
    border-radius: 0.25rem;
}

.btn-group-vertical.btn-group-sm .btn {
    margin-bottom: 0.25rem;
}

.btn-group-vertical.btn-group-sm .btn:last-child {
    margin-bottom: 0;
}

.hover-bg-light:hover {
    background-color: rgba(0,0,0,0.02) !important;
}

.min-width-0 {
    min-width: 0;
}

.recommendation-placeholder {
    border: 2px dashed #dee2e6;
    border-radius: 1rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.recommendation-placeholder .card-body {
    background: transparent;
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
}

/* Enhanced responsive design */
@media (max-width: 768px) {
    .search-container {
        margin-bottom: 1rem;
    }
    
    .filter-buttons .btn {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
    
    .tech-filters {
        max-height: 80px;
    }
    
    .btn-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.25rem;
    }
    
    .btn-group .btn {
        flex: 1;
        min-width: auto;
    }
    
    /* Featured projects mobile optimization */
    .featured-projects-card .card-header {
        padding: 1rem;
        text-align: center;
    }
    
    .featured-project-item {
        padding: 0.75rem 1rem !important;
        flex-direction: column;
        text-align: center;
    }
    
    .featured-project-item .flex-shrink-0 {
        margin-right: 0 !important;
        margin-bottom: 0.75rem;
        align-self: center;
    }
    
    .featured-project-item .flex-grow-1 {
        min-width: 100%;
        margin-bottom: 0.75rem;
    }
    
    .featured-project-item .d-flex.align-items-center {
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
    }
    
    .btn-group-vertical {
        flex-direction: row;
        justify-content: center;
        gap: 0.25rem;
    }
    
    .btn-group-vertical .btn {
        margin-bottom: 0;
    }
    
    /* Mobile project cards optimization */
    .col-lg-6 {
        margin-bottom: 1.5rem;
    }
    
    .card-body {
        padding: 1rem;
    }
    
    .card-title {
        font-size: 1.1rem;
    }
    
    .card-text {
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    .sticky-top {
        position: relative !important;
        top: auto !important;
        margin-top: 2rem;
    }
}

/* Tablet optimization */
@media (min-width: 769px) and (max-width: 1024px) {
    .filter-buttons .btn {
        font-size: 0.8rem;
        padding: 0.3rem 0.6rem;
    }
    
    .card-body {
        padding: 1.25rem;
    }
    
    .featured-project-item {
        padding: 1rem !important;
    }
    
    .sticky-top {
        top: 80px !important;
    }
}

/* Large screens optimization */
@media (min-width: 1400px) {
    .container {
        max-width: 1320px;
    }
    
    .card-body {
        padding: 1.75rem;
    }
    
    .featured-projects-card .card-header {
        padding: 1.5rem 2rem;
    }
    
    .featured-project-item {
        padding: 1.25rem 2rem !important;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Enhanced Portfolio Filter and Search System
class PortfolioFilter {
    constructor() {
        this.projects = [];
        this.filteredProjects = [];
        this.activeFilters = {
            search: '',
            type: 'all',
            status: 'all',
            tech: []
        };
        this.sortMethod = 'latest';
        
        this.init();
    }
    
    init() {
        this.cacheProjects();
        this.generateTechFilters();
        this.bindEvents();
        this.updateResults();
    }
    
    cacheProjects() {
        // Cache all project data for client-side filtering
        const projectCards = document.querySelectorAll('.col-lg-6');
        this.projects = Array.from(projectCards).map(card => {
            const titleElement = card.querySelector('.card-title a');
            const descElement = card.querySelector('.card-text');
            const techElements = card.querySelectorAll('.badge.bg-light');
            const statusElement = card.querySelector('.badge.bg-success, .badge.bg-warning, .badge.bg-secondary');
            const typeElement = card.querySelector('.card-header span:first-child');
            const dateElement = card.querySelector('.text-muted .fas.fa-calendar').nextSibling;
            const isFeatured = card.querySelector('.badge.bg-warning .fa-star') !== null;
            
            return {
                element: card,
                title: titleElement ? titleElement.textContent.trim() : '',
                description: descElement ? descElement.textContent.trim() : '',
                tech: Array.from(techElements).map(el => el.textContent.trim()),
                status: statusElement ? statusElement.textContent.trim() : '',
                type: typeElement ? typeElement.textContent.replace(/🌐|📱|🔧|🌟/g, '').trim() : '',
                date: dateElement ? dateElement.textContent.trim() : '',
                featured: isFeatured
            };
        });
        
        this.filteredProjects = [...this.projects];
    }
    
    generateTechFilters() {
        const techSet = new Set();
        this.projects.forEach(project => {
            project.tech.forEach(tech => techSet.add(tech));
        });
        
        const techFilters = document.getElementById('techFilters');
        const sortedTechs = Array.from(techSet).sort();
        
        techFilters.innerHTML = sortedTechs.map(tech => 
            `<span class="tech-filter-tag" data-tech="${tech}">${tech}</span>`
        ).join('');
    }
    
    bindEvents() {
        // Search input
        const searchInput = document.getElementById('projectSearch');
        searchInput.addEventListener('input', (e) => {
            this.activeFilters.search = e.target.value.toLowerCase();
            this.debounce(() => this.applyFilters(), 300)();
        });
        
        // Clear search
        document.getElementById('clearSearch').addEventListener('click', () => {
            searchInput.value = '';
            this.activeFilters.search = '';
            this.applyFilters();
        });
        
        // Project type filters
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.activeFilters.type = btn.dataset.filter;
                this.applyFilters();
            });
        });
        
        // Status filters
        document.querySelectorAll('.status-filter').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.status-filter').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                this.activeFilters.status = btn.dataset.status;
                this.applyFilters();
            });
        });
        
        // Tech filters
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('tech-filter-tag')) {
                e.target.classList.toggle('active');
                const tech = e.target.dataset.tech;
                
                if (e.target.classList.contains('active')) {
                    if (!this.activeFilters.tech.includes(tech)) {
                        this.activeFilters.tech.push(tech);
                    }
                } else {
                    this.activeFilters.tech = this.activeFilters.tech.filter(t => t !== tech);
                }
                
                this.applyFilters();
            }
        });
        
        // Sort options
        document.querySelectorAll('.sort-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.sort-option').forEach(o => o.classList.remove('active'));
                option.classList.add('active');
                this.sortMethod = option.dataset.sort;
                
                // Update dropdown text
                const dropdownBtn = document.getElementById('sortDropdown');
                dropdownBtn.innerHTML = `<i class="fas fa-sort me-1"></i>${option.textContent.trim()}`;
                
                this.applySorting();
                this.updateResults();
            });
        });
        
        // Clear all filters
        document.getElementById('clearAllFilters').addEventListener('click', () => {
            this.clearAllFilters();
        });
        
        // URL state management
        window.addEventListener('popstate', (e) => {
            this.loadFromURL();
        });
    }
    
    applyFilters() {
        this.filteredProjects = this.projects.filter(project => {
            // Search filter
            if (this.activeFilters.search) {
                const searchTerm = this.activeFilters.search;
                const searchText = `${project.title} ${project.description} ${project.tech.join(' ')}`.toLowerCase();
                if (!searchText.includes(searchTerm)) {
                    return false;
                }
            }
            
            // Type filter
            if (this.activeFilters.type !== 'all' && project.type !== this.activeFilters.type) {
                return false;
            }
            
            // Status filter
            if (this.activeFilters.status !== 'all' && project.status !== this.activeFilters.status) {
                return false;
            }
            
            // Tech filters
            if (this.activeFilters.tech.length > 0) {
                const hasMatchingTech = this.activeFilters.tech.some(tech => 
                    project.tech.includes(tech)
                );
                if (!hasMatchingTech) {
                    return false;
                }
            }
            
            return true;
        });
        
        this.applySorting();
        this.updateResults();
        this.updateURL();
        this.updateClearButton();
    }
    
    applySorting() {
        this.filteredProjects.sort((a, b) => {
            switch (this.sortMethod) {
                case 'featured':
                    if (a.featured && !b.featured) return -1;
                    if (!a.featured && b.featured) return 1;
                    return 0;
                    
                case 'status':
                    const statusOrder = ['开发中', '规划中', '已完成'];
                    const aIndex = statusOrder.indexOf(a.status);
                    const bIndex = statusOrder.indexOf(b.status);
                    return aIndex - bIndex;
                    
                case 'alphabetical':
                    return a.title.localeCompare(b.title);
                    
                case 'latest':
                default:
                    // Default to order in HTML (latest first)
                    return 0;
            }
        });
    }
    
    updateResults() {
        const projectsGrid = document.querySelector('.row.g-4.mb-5');
        const noResults = document.getElementById('noResults');
        
        // Hide all projects
        this.projects.forEach(project => {
            project.element.style.display = 'none';
        });
        
        // Show filtered projects
        if (this.filteredProjects.length > 0) {
            this.filteredProjects.forEach((project, index) => {
                project.element.style.display = 'block';
                project.element.style.order = index;
            });
            
            if (noResults) noResults.style.display = 'none';
        } else {
            this.showNoResults();
        }
        
        // Update results count
        document.getElementById('resultsCount').textContent = this.filteredProjects.length;
    }
    
    showNoResults() {
        let noResults = document.getElementById('noResults');
        if (!noResults) {
            noResults = document.createElement('div');
            noResults.id = 'noResults';
            noResults.className = 'col-12 no-results';
            noResults.innerHTML = `
                <i class="fas fa-search"></i>
                <h5>未找到匹配的项目</h5>
                <p>尝试调整搜索条件或清除筛选器</p>
                <button class="btn btn-primary btn-sm" onclick="portfolioFilter.clearAllFilters()">
                    <i class="fas fa-eraser me-1"></i>清除所有筛选
                </button>
            `;
            
            document.querySelector('.row.g-4.mb-5').appendChild(noResults);
        }
        noResults.style.display = 'block';
    }
    
    updateClearButton() {
        const hasActiveFilters = this.activeFilters.search || 
                               this.activeFilters.type !== 'all' || 
                               this.activeFilters.status !== 'all' || 
                               this.activeFilters.tech.length > 0;
        
        document.getElementById('clearAllFilters').style.display = hasActiveFilters ? 'block' : 'none';
    }
    
    clearAllFilters() {
        // Reset all filters
        this.activeFilters = {
            search: '',
            type: 'all',
            status: 'all',
            tech: []
        };
        
        // Reset UI
        document.getElementById('projectSearch').value = '';
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.filter === 'all') btn.classList.add('active');
        });
        document.querySelectorAll('.status-filter').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.status === 'all') btn.classList.add('active');
        });
        document.querySelectorAll('.tech-filter-tag').forEach(tag => {
            tag.classList.remove('active');
        });
        
        this.applyFilters();
    }
    
    updateURL() {
        const params = new URLSearchParams();
        
        if (this.activeFilters.search) params.set('search', this.activeFilters.search);
        if (this.activeFilters.type !== 'all') params.set('type', this.activeFilters.type);
        if (this.activeFilters.status !== 'all') params.set('status', this.activeFilters.status);
        if (this.activeFilters.tech.length > 0) params.set('tech', this.activeFilters.tech.join(','));
        if (this.sortMethod !== 'latest') params.set('sort', this.sortMethod);
        
        const newURL = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
        window.history.replaceState(null, '', newURL);
    }
    
    loadFromURL() {
        const params = new URLSearchParams(window.location.search);
        
        this.activeFilters.search = params.get('search') || '';
        this.activeFilters.type = params.get('type') || 'all';
        this.activeFilters.status = params.get('status') || 'all';
        this.activeFilters.tech = params.get('tech') ? params.get('tech').split(',') : [];
        this.sortMethod = params.get('sort') || 'latest';
        
        // Update UI to match URL
        document.getElementById('projectSearch').value = this.activeFilters.search;
        
        this.applyFilters();
    }
    
    debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
}

// Initialize filter system when page loads
let portfolioFilter;
document.addEventListener('DOMContentLoaded', function() {
    // Only initialize if we're on the portfolio page and have projects
    if (document.querySelector('.row.g-4.mb-5') && document.querySelectorAll('.col-lg-6').length > 0) {
        portfolioFilter = new PortfolioFilter();
    }
});
</script>
{% endblock %}